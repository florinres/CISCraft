<UserControl x:Class="Ui.Views.UserControls.Diagram.DiagramUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:diagram="clr-namespace:Ui.Views.UserControls.Diagram"
             xmlns:diagram1="clr-namespace:Ui.ViewModels.Components.Diagram"
             xmlns:components="clr-namespace:Ui.Views.UserControls.Diagram.Components"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=diagram1:DiagramViewModel, IsDesignTimeCreatable=False}"
             >
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"></RowDefinition>
            <RowDefinition Height="Auto"></RowDefinition>
        </Grid.RowDefinitions>
        <Grid Width="1500" Height="700"
              Background="Transparent">
            <Grid ShowGridLines="False"
                  Background="Transparent"
                  Margin="0"
                  x:Name="MainDiagramGrid"
                  UseLayoutRounding="True"
                  VerticalAlignment="Center"
                  HorizontalAlignment="Center">
                <Grid.RenderTransform>
                    <ScaleTransform x:Name="DiagramScaleTransform"
                                    ScaleX="{Binding ZoomFactor, Mode=TwoWay}"
                                    ScaleY="{Binding ZoomFactor, Mode=TwoWay}" />
                </Grid.RenderTransform>
                <Grid.RowDefinitions>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                    <RowDefinition Height="20"></RowDefinition>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                    <ColumnDefinition Width="20"></ColumnDefinition>
                </Grid.ColumnDefinitions>

                <!-- IO 0 -->
                <Border
                    x:Name="IO0"
                    Grid.Column="10"
                    Grid.ColumnSpan="9"
                    Grid.Row="2"
                    BorderBrush="{DynamicResource NodeBorderBrush}"
                    BorderThickness="2"
                    Padding="1"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Stretch"
                    CornerRadius="4">
                    <TextBlock Text="I/O 0"
                               Foreground="{DynamicResource DiagramTextBrush}"
                               FontWeight="Bold"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Center"
                               TextAlignment="Center"
                               Padding="2" />
                </Border>

                <!-- IO 1 -->
                <Border
                    x:Name="IO1"
                    Grid.Column="28"
                    Grid.ColumnSpan="9"
                    Grid.Row="2"
                    BorderBrush="{DynamicResource NodeBorderBrush}"
                    BorderThickness="2"
                    Padding="1"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Stretch"
                    CornerRadius="4">
                    <TextBlock Text="I/O 1"
                               Foreground="{DynamicResource DiagramTextBrush}"
                               FontWeight="Bold"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Center"
                               TextAlignment="Center"
                               Padding="2" />
                </Border>

                <!-- IO 2 -->
                <Border
                    x:Name="IO2"
                    Grid.Column="47"
                    Grid.ColumnSpan="9"
                    Grid.Row="2"
                    BorderBrush="{DynamicResource NodeBorderBrush}"
                    BorderThickness="2"
                    Padding="1"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Stretch"
                    CornerRadius="4">
                    <TextBlock Text="I/O 2"
                               Foreground="{DynamicResource DiagramTextBrush}"
                               FontWeight="Bold"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Center"
                               TextAlignment="Center"
                               Padding="2" />
                </Border>

                <!-- IO 3 -->
                <Border
                    x:Name="IO3"
                    Grid.Column="65"
                    Grid.ColumnSpan="9"
                    Grid.Row="2"
                    BorderBrush="{DynamicResource NodeBorderBrush}"
                    BorderThickness="2"
                    Padding="1"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Stretch"
                    CornerRadius="4">
                    <TextBlock Text="I/O 3"
                               Foreground="{DynamicResource DiagramTextBrush}"
                               FontWeight="Bold"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Center"
                               TextAlignment="Center"
                               Padding="2" />
                </Border>

                <!-- SIE -->
                <Border
                    x:Name="Sie"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    Grid.Row="4"
                    Grid.RowSpan="2"
                    BorderBrush="{DynamicResource NodeBorderBrush}"
                    BorderThickness="2"
                    Padding="4"
                    VerticalAlignment="Center"
                    CornerRadius="4">
                    <TextBlock Text="SIE"
                               Foreground="{DynamicResource DiagramTextBrush}"
                               FontWeight="Bold"
                               HorizontalAlignment="Stretch"
                               VerticalAlignment="Center"
                               TextAlignment="Center"
                               Padding="2" />
                </Border>

                <!-- Control Unit -->
                <Border
                    Grid.Column="10"
                    Grid.Row="7"
                    Grid.ColumnSpan="20"
                    Grid.RowSpan="8"
                    BorderBrush="{DynamicResource NodeBorderBrush}"
                    BorderThickness="2"
                    Padding="1"
                    CornerRadius="4"
                    Panel.ZIndex="100"
                    VerticalAlignment="Stretch"
                    HorizontalAlignment="Stretch">
                        <TextBlock
                            TextAlignment="Center"
                            Foreground="{DynamicResource DiagramTextBrush}">
                            CU
                        </TextBlock>
                </Border>

                <components:RegisterBlock
                    x:Name="Mir"
                    Grid.Column="11"
                    Grid.Row="9"
                    Grid.ColumnSpan="18"
                    Panel.ZIndex="200"
                    DataContext="{Binding MirContext}" />

                <components:RegisterBlock
                    x:Name="Mar"
                    Grid.Column="19"
                    Grid.ColumnSpan="10"
                    Grid.Row="11"
                    Panel.ZIndex="200"
                    DataContext="{Binding MarContext}" />

                <components:RegisterBlock
                    x:Name="Ir"
                    Grid.Column="19"
                    Grid.ColumnSpan="10"
                    Grid.Row="13"
                    Panel.ZIndex="200"
                    DataContext="{Binding IRContext}" />

                <!-- RAM -->
                <Border
                    Grid.Column="18"
                    Grid.Row="22"
                    Grid.RowSpan="8"
                    Grid.ColumnSpan="12"
                    BorderBrush="{DynamicResource NodeBorderBrush}"
                    BorderThickness="2"
                    Padding="1"
                    CornerRadius="4"
                    Panel.ZIndex="100"
                    VerticalAlignment="Stretch"
                    HorizontalAlignment="Stretch">
                        <TextBlock
                            TextAlignment="Center"
                            Foreground="{DynamicResource DiagramTextBrush}">
                            RAM
                        </TextBlock>
                </Border>

                <components:RegisterBlock
                    x:Name="DataIn"
                    Grid.Column="19"
                    Grid.Row="24"
                    Grid.ColumnSpan="10"
                    Panel.ZIndex="200"
                    DataContext="{Binding DataInContext }" />

                <components:RegisterBlock
                    x:Name="DataOut"
                    Grid.Column="19"
                    Grid.Row="26"
                    Grid.ColumnSpan="10"
                    Panel.ZIndex="200"
                    DataContext="{Binding DataOutContext }" />

                <components:RegisterBlock
                    x:Name="Address"
                    Grid.Column="19"
                    Grid.Row="28"
                    Grid.ColumnSpan="10"
                    Panel.ZIndex="200"
                    DataContext="{Binding ADRContext }" />

                <components:RegisterBlock
                    x:Name="Ivr"
                    Grid.Row="7"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    DataContext="{Binding IVRContext}"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Stretch" />

                <components:RegisterBlock
                    x:Name="Pc"
                    Grid.Row="9"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    DataContext="{Binding PCContext}"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Stretch" />

                <components:RegisterBlock
                    x:Name="T"
                    Grid.Row="11"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    DataContext="{Binding TContext}"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Stretch" />

                <components:RegisterBlock
                    x:Name="Sp"
                    Grid.Row="15"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    DataContext="{Binding SPContext}"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Stretch" />

                <components:RegisterBlock
                    x:Name="Flags"
                    Grid.Row="17"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    DataContext="{Binding FLAGContext}"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Stretch" />

                <Grid 
                    Grid.Row="19"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    Grid.RowSpan="2"
                    Margin="0,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <components:BitBlock x:Name="BVI" Grid.Column="0" DataContext="{Binding BVIContext}" />
                    <components:BitBlock x:Name="C" Grid.Column="1" DataContext="{Binding CContext}" />
                    <components:BitBlock x:Name="Z" Grid.Column="2" DataContext="{Binding ZContext}" />
                    <components:BitBlock x:Name="S" Grid.Column="3" DataContext="{Binding SContext}" />
                    <components:BitBlock x:Name="V" Grid.Column="4" DataContext="{Binding VContext}" />
                </Grid>

                <components:RegisterBlock
                    x:Name="Mdr"
                    Grid.Row="23"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Stretch"
                    DataContext="{Binding MDRContext}" />

                <components:RegisterBlock
                    x:Name="Adr"
                    Grid.Row="25"
                    Grid.Column="37"
                    Grid.ColumnSpan="10"
                    VerticalAlignment="Bottom"
                    HorizontalAlignment="Stretch"
                    DataContext="{Binding ADRContext}" />

                <components:StraightLineBus
                    x:Name="SBus"
                    Grid.Row="7"
                    Grid.RowSpan="20"
                    Grid.Column="50"
                    LineWidth="8"
                    Panel.ZIndex="300"
                    HorizontalAlignment="Right"
                    LineHeight="500" />

                <components:StraightLineBus
                    x:Name="DBus"
                    Grid.Row="7"
                    Grid.RowSpan="20"
                    Grid.Column="52"
                    LineWidth="8"
                    Panel.ZIndex="300"
                    HorizontalAlignment="Left"
                    LineHeight="500" />

                <!-- GPR -->
                <Border
                    Grid.Column="56"
                    Grid.ColumnSpan="10"
                    Grid.Row="7"
                    Grid.RowSpan="17"
                    BorderBrush="{DynamicResource NodeBorderBrush}"
                    BorderThickness="2"
                    Padding="1"
                    VerticalAlignment="Center"
                    CornerRadius="4">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                            <RowDefinition Height="Auto"></RowDefinition>
                        </Grid.RowDefinitions>
                        <components:RegisterBlock x:Name="R0" Grid.Row="0" DataContext="{Binding R0Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R1" Grid.Row="1" DataContext="{Binding R1Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R2" Grid.Row="2" DataContext="{Binding R2Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R3" Grid.Row="3" DataContext="{Binding R3Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R4" Grid.Row="4" DataContext="{Binding R4Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R5" Grid.Row="5" DataContext="{Binding R5Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R6" Grid.Row="6" DataContext="{Binding R6Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R7" Grid.Row="7" DataContext="{Binding R7Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R8" Grid.Row="8" DataContext="{Binding R8Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R9" Grid.Row="9" DataContext="{Binding R9Context }"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R10" Grid.Row="10" DataContext="{Binding R10Context}"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R11" Grid.Row="11" DataContext="{Binding R11Context}"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R12" Grid.Row="12" DataContext="{Binding R12Context}"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R13" Grid.Row="13" DataContext="{Binding R13Context}"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R14" Grid.Row="14" DataContext="{Binding R14Context}"
                                                  WithBorder="False" Height="20" />
                        <components:RegisterBlock x:Name="R15" Grid.Row="15" DataContext="{Binding R15Context}"
                                                  WithBorder="False" Height="20" />
                    </Grid>
                </Border>

                <diagram:AroundTheEdgeBus
                    x:Name="RBus"
                    Grid.Row="7"
                    Grid.RowSpan="23"
                    Grid.Column="33"
                    Grid.ColumnSpan="41"
                    LineThickness="11"
                    Panel.ZIndex="300"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch" />

                <diagram:SumBlock
                    x:Name="Alu"
                    Grid.Row="27"
                    Grid.Column="50"
                    Grid.RowSpan="3"
                    Grid.ColumnSpan="3"
                    Panel.ZIndex="999"
                    Margin="0,-10,0,10"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Center" />

                <Canvas
                    x:Name="ConnectionCanvas"
                    Grid.Row="0"
                    Grid.RowSpan="10"
                    Grid.Column="0"
                    Grid.ColumnSpan="12"
                    Background="Transparent"
                    IsHitTestVisible="True"
                    Panel.ZIndex="100"
                    Margin="0"
                    UseLayoutRounding="True">
                </Canvas>
                <!-- new: overlay goes here -->
                <Canvas
                    x:Name="OverlayCanvas"
                    Grid.Row="0" Grid.RowSpan="10"
                    Grid.Column="0" Grid.ColumnSpan="12"
                    Background="Transparent"
                    IsHitTestVisible="False"
                    Panel.ZIndex="400" />
            </Grid>
        </Grid>
        <components:MicroprogramMemory
            Grid.Row="1"
            DataContext="{Binding MemoryContext}"
            Margin="0,0,0,10"
            VerticalAlignment="Bottom"
            HorizontalAlignment="Stretch"/>
    </Grid>
</UserControl>