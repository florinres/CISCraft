<ui:MenuItem x:Class="Ui.Views.UserControls.MenuBar.LayoutControl"
     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
     xmlns:viewModel1="clr-namespace:Ui.Interfaces.ViewModel"
     xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
     d:DataContext="{d:DesignInstance Type=viewModel1:ILayoutControlViewModel, IsDesignTimeCreatable=False}"
     mc:Ignorable="d"
     x:Name="LayoutsRoot"
     Header="Layouts"
     StaysOpenOnClick="True">

    <ui:MenuItem Header="Layouts" x:Name="LayoutsMenuRoot" StaysOpenOnClick="True">

        <!-- ✅ Dynamic items from LayoutNames -->
        <ui:MenuItem.ItemsSource>
            <Binding Path="LayoutNames" />
        </ui:MenuItem.ItemsSource>

        <ui:MenuItem.ItemContainerStyle>
            <Style TargetType="MenuItem">
                <Setter Property="Command" Value="{Binding DataContext.LoadLayoutCommand, ElementName=LayoutsRoot}" />
                <Setter Property="CommandParameter" Value="{Binding}" />
                <Setter Property="HeaderTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock Text="{Binding}" VerticalAlignment="Center" Margin="5,0,0,0" />
                                <ui:Button Grid.Column="1"
                                           Content="🗑️"
                                           Command="{Binding DataContext.DeleteLayoutCommand, ElementName=LayoutsRoot}"
                                           CommandParameter="{Binding}"
                                           Padding="2"
                                           Margin="5,0,5,0"
                                           VerticalAlignment="Center"
                                           Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}" />
                            </Grid>
                        </DataTemplate>
                    </Setter.Value>
                </Setter>
                <Setter Property="ContextMenu">
                    <Setter.Value>
                        <ContextMenu>
                            <ui:MenuItem Header="Overwrite with current layout"
                                         Command="{Binding DataContext.SaveLayoutCommand, ElementName=LayoutsRoot}"
                                         CommandParameter="{Binding}" />
                        </ContextMenu>
                    </Setter.Value>
                </Setter>
            </Style>
        </ui:MenuItem.ItemContainerStyle>
    </ui:MenuItem>

    <!-- 🟦 Static section after dynamic menu -->
    <Separator />
    
    <ui:MenuItem Header="Add Layout" x:Name="AddLayoutMenu" StaysOpenOnClick="True">
        <ui:MenuItem StaysOpenOnClick="True">
            <MenuItem.Header>
                <StackPanel>
                    <TextBlock Text="Enter layout name:" />
                    <TextBox x:Name="LayoutNameInput" 
                             Width="150" 
                             Margin="0,5,0,0"
                             Text="{Binding LayoutName, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Content="Save Layout"
                            Command="{Binding SaveLayoutCommand}"
                            CommandParameter="{Binding Text, ElementName=LayoutNameInput}"
                            Margin="0,5,0,0" />
                </StackPanel>
            </MenuItem.Header>
        </ui:MenuItem>
    </ui:MenuItem>

    <!-- <Popup x:Name="AddLayoutPopup" -->
    <!--        Placement="MousePoint" -->
    <!--        StaysOpen="False" -->
    <!--        AllowsTransparency="True" -->
    <!--        PopupAnimation="Fade"> -->
    <!--     <Border BorderThickness="1" Padding="10"> -->
    <!--         <StackPanel> -->
    <!--             <ui:TextBlock Text="Enter layout name:" Margin="0,0,0,5"/> -->
    <!--             <ui:TextBox x:Name="LayoutNameInput" Width="150" /> -->
    <!--             <ui:Button Content="Save Layout" -->
    <!--                        Command="{Binding SaveLayoutCommand}" -->
    <!--                        CommandParameter="{Binding Text, ElementName=LayoutNameInput}" -->
    <!--                        Margin="0,5,0,0" /> -->
    <!--         </StackPanel> -->
    <!--     </Border> -->
    <!-- </Popup> -->

</ui:MenuItem>
